/*! For license information please see audio-player-view-script.js.LICENSE.txt */
!function(){"use strict";var e={"./src/blocks/dynamic/audio-player/components/AudioPlayer.jsx":function(e,t,a){a.r(t);var r=a("@wordpress/element"),i=a("@wordpress/i18n"),n=a("./src/blocks/dynamic/audio-player/icons/index.js"),s=a("./src/blocks/dynamic/audio-player/context/PlayerContext.js"),l=a("./src/features/analytics/index.js");t.default=({playerRef:e,trackRef:t})=>{const{isPlaying:a,setIsPlaying:u}=(0,r.useContext)(s.default),[o,c]=(0,r.useState)(0),[d,m]=(0,r.useState)(0),[p,y]=(0,r.useState)(0);function f(e){const t=Math.floor(e/60),a=e-60*t;return`${t}:${a<10?"0":""}${a}`}return(0,r.useEffect)((()=>{(async()=>{if(a)switch(d){case 16:case 26:case 51:case 76:await(0,l.pushMusicEventsToDatalayer)(t.current,o,"stream")}})()}),[d]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"audio-player",tabIndex:"-1","aria-hidden":"true"},(0,r.createElement)("div",{className:"audio-player__info"},(0,r.createElement)("button",{className:"audio-player__btn audio-player__btn--play","data-state":a?"pause":"play",onClick:async function(r){await u(!a);const i=e.current;a?(i.pause(),(0,l.pushMusicEventsToDatalayer)(t.current,i.currentTime,"pause")):(i.play(),(0,l.pushMusicEventsToDatalayer)(t.current,i.currentTime,"play"))},tabIndex:-1,"aria-hidden":"true"},(0,r.createElement)("span",{className:"is-visually-hidden"},a?(0,i.__)("Pause","kotisivu-block-theme"):(0,i.__)("Play","kotisivu-block-theme")),a?(0,r.createElement)(n.StopButton,null):(0,r.createElement)(n.PlayButton,null)),(0,r.createElement)("div",{className:"audio-player__track-details"},(0,r.createElement)("div",{className:"audio-player__now-playing"},(0,r.createElement)("h3",null,(0,i.__)("Now Playing","kotisivu-block-theme")),(0,r.createElement)("div",{className:"audio-player__quality"},(0,r.createElement)("span",{className:"audio-player__quality-item"},t.current?.format),(0,r.createElement)("span",{className:"audio-player__quality-item"},t.current?.sampleRate))),(0,r.createElement)("p",{className:"audio-player__track-name"},!t.current?.artist&&(0,i.__)("Loading...","kotisivu-block-theme"),t.current?.artist&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)("span",{className:"audio-player__artist"},t.current?.artist),":"," ",(0,r.createElement)("span",{className:"audio-player__album"},t.current?.album)))),t.current?.featuredImage?(0,r.createElement)("img",{className:"audio-player__cover",src:t.current?.featuredImage.src,width:t.current?.featuredImage.width,height:t.current?.featuredImage.height,alt:t.current?.featuredImage.alt}):(0,r.createElement)(n.Placeholder,null)),(0,r.createElement)("div",{className:"audio-player__timeline"},(0,r.createElement)("div",{className:"audio-player__timeline-elapsed"},(0,r.createElement)("span",{className:"is-visually-hidden"},(0,i.__)("Elapsed Time","kotisivu-block-theme")),f(o)),(0,r.createElement)("label",{htmlFor:"audio-timeline",className:"is-visually-hidden"},(0,i.__)("Timeline","kotisivu-block-theme")),(0,r.createElement)("input",{type:"range",id:"audio-timeline",value:o,min:0,max:p,onChange:async function(r){const i=parseFloat(r.target.value);await c(i),e.current.currentTime=i,a&&(0,l.pushMusicEventsToDatalayer)(t.current,i,"seek")},"aria-valuetext":`${o} seconds`,tabIndex:-1}),(0,r.createElement)("div",{className:"audio-player__timeline-duration"},(0,r.createElement)("span",{className:"is-visually-hidden"},(0,i.__)("Total Duration","kotisivu-block-theme")),f(p)))),(0,r.createElement)("audio",{className:"is-visually-hidden",controls:!0,ref:e,src:t.current?.src,onLoadedMetadata:async function(){await y(Math.round(e.current.duration))},onTimeUpdate:async function(){await c(Math.round(e.current.currentTime)),await m(Math.round(o/p*100))},onPlay:()=>u(!0),onPause:()=>u(!1)}),(0,r.createElement)("p",{className:"is-visually-hidden"},`${(0,i.__)("Now playing song","kotisivu-block-theme")} ${t.current?.album} ${(0,i.__)("from artist","kotisivu-block-theme")} ${t.current?.artist}`))}},"./src/blocks/dynamic/audio-player/context/PlayerContext.js":function(e,t,a){a.r(t);var r=a("@wordpress/element");const i=(0,r.createContext)(null);t.default=i},"./src/blocks/dynamic/audio-player/hooks/index.js":function(e,t,a){a.r(t),a.d(t,{useMediaFiles:function(){return r.useMediaFiles},usePlaylistOnScreen:function(){return i.usePlaylistOnScreen}});var r=a("./src/blocks/dynamic/audio-player/hooks/lib/useMediaFiles.js"),i=a("./src/blocks/dynamic/audio-player/hooks/lib/usePlaylistOnScreen.js")},"./src/blocks/dynamic/audio-player/hooks/lib/useMediaFiles.js":function(e,t,a){a.r(t),a.d(t,{useMediaFiles:function(){return n}});var r=a("./src/blocks/dynamic/audio-player/scripts/helpers.js"),i=a("@wordpress/element");function n(e){const[t,a]=(0,i.useState)([]),[n,s]=(0,i.useState)(!0);return(0,i.useEffect)((()=>{(async()=>{let t=await(0,r.getMediaFiles)({per_page:25,media_type:"audio"});await a(t),e.current={id:0,title:t[0]?.title?.rendered,album:t[0]?.media_details?.album,artist:t[0]?.media_details?.artist,format:t[0]?.media_details?.fileformat,sampleRate:t[0]?.media_details?.sample_rate,src:t[0]?.source_url,duration:t[0]?.media_details?.length,durationFormatted:t[0]?.media_details?.length_formatted,featuredImage:{src:t[0]?.metadata?.featured_image?.url,alt:t[0]?.metadata?.featured_image?.alt,height:t[0]?.metadata?.featured_image?.height,width:t[0]?.metadata?.featured_image?.width,title:t[0]?.metadata?.featured_image?.title}},s(!1)})()}),[]),[t,n]}},"./src/blocks/dynamic/audio-player/hooks/lib/usePlaylistOnScreen.js":function(e,t,a){a.r(t),a.d(t,{usePlaylistOnScreen:function(){return i}});var r=a("@wordpress/element");function i(e){const t=(0,r.useRef)(null),[a,i]=(0,r.useState)(!1),n=e=>{e.forEach((e=>{e.isIntersecting&&i(!0)}))};return(0,r.useEffect)((()=>{const a=new IntersectionObserver(n,e);return t.current&&a.observe(t.current),()=>{t.current&&a.unobserve(t.current)}}),[t.current,e]),[t,a]}},"./src/blocks/dynamic/audio-player/icons/index.js":function(e,t,a){a.r(t),a.d(t,{Placeholder:function(){return n.Placeholder},PlayButton:function(){return r.PlayButton},StopButton:function(){return i.StopButton}});var r=a("./src/blocks/dynamic/audio-player/icons/lib/PlayButton.jsx"),i=a("./src/blocks/dynamic/audio-player/icons/lib/StopButton.jsx"),n=a("./src/blocks/dynamic/audio-player/icons/lib/Placeholder.jsx")},"./src/blocks/dynamic/audio-player/icons/lib/Placeholder.jsx":function(e,t,a){a.r(t),a.d(t,{Placeholder:function(){return i}});var r=a("@wordpress/element");const i=e=>(0,r.createElement)("svg",{className:"music-playlist__placeholder-image",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:400,height:400,style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 400 400",...e},(0,r.createElement)("path",{d:"M0 0h400v400H0z",style:{fill:"#ebebeb"}}))},"./src/blocks/dynamic/audio-player/icons/lib/PlayButton.jsx":function(e,t,a){a.r(t),a.d(t,{PlayButton:function(){return i}});var r=a("@wordpress/element");const i=e=>(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 1000 1000","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M500 0c275.958 0 500 224.042 500 500 0 275.958-224.042 500-500 500C224.042 1000 0 775.958 0 500 0 224.042 224.042 0 500 0Zm264 500L336 209.5v581L764 500Z",style:{fill:"var(--wp--preset--color--primary)"}}))},"./src/blocks/dynamic/audio-player/icons/lib/StopButton.jsx":function(e,t,a){a.r(t),a.d(t,{StopButton:function(){return i}});var r=a("@wordpress/element");const i=e=>(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 1000 1000","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M500 0c275.958 0 500 224.042 500 500 0 275.958-224.042 500-500 500C224.042 1000 0 775.958 0 500 0 224.042 224.042 0 500 0Zm-49.799 236H305.522v528h144.679V236Zm244.277 0H549.799v528h144.679V236Z",style:{fill:"var(--wp--preset--color--primary)"}}))},"./src/blocks/dynamic/audio-player/scripts/helpers.js":function(e,t,a){a.r(t),a.d(t,{convertEntityToText:function(){return s},getMediaFiles:function(){return n}});var r=a("@wordpress/api-fetch"),i=a.n(r);async function n(e=null){let t=new URL(window.location.origin+"/wp/v2/media");for(const[a,r]of Object.entries(e))t.searchParams.append(a,r);return await i()({path:t.pathname+t.search}).then((e=>e))}function s(e){const t={"&#8211;":"-"};for(const a in t)if(e.indexOf(a)>=0){return e.replaceAll(a,t[a])}return e}},"./src/features/analytics/index.js":function(e,t,a){a.r(t),a.d(t,{pushMusicEventsToDatalayer:function(){return r.pushMusicEventsToDatalayer},pushMusicViewEventsToDataLayer:function(){return r.pushMusicViewEventsToDataLayer}});var r=a("./src/features/analytics/lib/music-player.js")},"./src/features/analytics/lib/music-player.js":function(e,t,a){a.r(t),a.d(t,{pushMusicEventsToDatalayer:function(){return l},pushMusicViewEventsToDataLayer:function(){return u}});const r=async e=>["play","pause","complete","seek","stream"].includes(e)?e:"undefined",i=async({id:e,title:t,artist:a,album:r,sampleRate:i,format:n})=>({id:e,title:t,artist:a,album:r,meta:{sampleRate:i,format:n}}),n=(e,t)=>{const a=Math.round(e/t*100),r={0:15,15:25,25:50,50:75,75:100};for(let e in r)if(a<=r[e])return e},s=async e=>e.map(((e,t)=>({id:t,title:e?.title.rendered,artist:e?.media_details?.artist,album:e?.media_details?.album,meta:{sampleRate:e?.media_details?.sample_rate,format:e?.media_details?.fileformat},time:{duration:e?.media_details?.length,durationFormatted:e?.media_details?.length_formatted}})));async function l(e,t,a){const s=await r(a),l=await n(t,e?.duration),u=await i(e),o={current:Math.round(t),duration:e?.duration,percent:Math.round(t/e?.duration*100)};window.dataLayer=window.dataLayer||[],"seek"!==s&&"stream"!==s&&window.dataLayer.push({event:`music_${s}`,song:u,time:o}),window.dataLayer.push({event:`music_${a}_${l}`,song:u,time:o})}async function u(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"music_view_tracks",songs:await s(e)})}},"@wordpress/api-fetch":function(e){e.exports=window.wp.apiFetch},"@wordpress/dom-ready":function(e){e.exports=window.wp.domReady},"@wordpress/element":function(e){e.exports=window.wp.element},"@wordpress/i18n":function(e){e.exports=window.wp.i18n}},t={};function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};!function(){a.r(r);var e=a("@wordpress/element"),t=a("@wordpress/i18n"),i=a("@wordpress/dom-ready"),n=a.n(i),s=a("./src/blocks/dynamic/audio-player/context/PlayerContext.js"),l=a("./src/blocks/dynamic/audio-player/hooks/index.js"),u=a("./src/blocks/dynamic/audio-player/components/AudioPlayer.jsx"),o=a("./src/blocks/dynamic/audio-player/icons/index.js"),c=a("./src/blocks/dynamic/audio-player/scripts/helpers.js"),d=a("./src/features/analytics/index.js");const m=()=>{const a=(0,e.useRef)(null),r=(0,e.useRef)(0),i=(0,e.useRef)(null),[n,m]=(0,e.useState)(!1),[,p]=(0,e.useState)(Date.now()),[y,f]=(0,l.useMediaFiles)(a),[h,_]=(0,l.usePlaylistOnScreen)({root:null,rootMargin:"0px",threshold:.5});async function w(){const e=i.current,t=await y.find(((e,t)=>{if(t===r.current)return e}));a.current={id:r.current,title:t.title.rendered,album:t.media_details?.album,artist:t.media_details?.artist,format:t.media_details?.fileformat,sampleRate:t.media_details?.sample_rate,src:t.source_url,duration:t.media_details?.length,durationFormatted:t.media_details?.length_formatted,featuredImage:{src:t.metadata?.featured_image?.url,alt:t.metadata?.featured_image?.alt,height:t.metadata?.featured_image?.height,width:t.metadata?.featured_image?.width,title:t.metadata?.featured_image?.title}},await p(Date.now());document.querySelector('.audio-player__list-item[aria-current="true"]').focus(),n&&(e.play(),m(!0),(0,d.pushMusicEventsToDatalayer)(a.current,e.currentTime,"play"))}async function g(e){const t=i.current,s=parseInt(document.activeElement.dataset.id);switch(e.key){case" ":if(s===r.current)(async()=>{n?(t.pause(),m(!1),(0,d.pushMusicEventsToDatalayer)(a.current,t.currentTime,"pause")):(t.play(),m(!0),(0,d.pushMusicEventsToDatalayer)(a.current,t.currentTime,"play"))})();else{r.current=s;const e=await y.find(((e,t)=>{if(s===t)return e}));a.current={id:r.current,title:e.title.rendered,album:e.media_details?.album,artist:e.media_details?.artist,format:e.media_details?.fileformat,sampleRate:e.media_details?.sample_rate,src:e.source_url,duration:e.media_details?.length,durationFormatted:e.media_details?.length_formatted,featuredImage:{src:e.metadata?.featured_image?.url,alt:e.metadata?.featured_image?.alt,height:e.metadata?.featured_image?.height,width:e.metadata?.featured_image?.width,title:e.metadata?.featured_image?.title}},await p(Date.now()),i.current.play(),m(!0),(0,d.pushMusicEventsToDatalayer)(a.current,t.currentTime,"play")}break;case"ArrowDown":"LI"===e.target.tagName&&e.preventDefault(),await(async()=>{r.current===y.length-1?r.current=0:r.current=r.current+1})(),w();break;case"ArrowUp":"LI"===e.target.tagName&&e.preventDefault(),await(async()=>{0===r.current?r.current=y.length-1:r.current=r.current-1})(),w()}await p(Date.now())}return(0,e.useEffect)((()=>{_&&0!==y.length&&(0,d.pushMusicViewEventsToDataLayer)(y)}),[_,y]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.default.Provider,{value:{isPlaying:n,setIsPlaying:m}},!y.length&&f&&(0,e.createElement)("div",null,(0,t.__)("Loading...","kotisivu-block-theme")),!y.length&&!f&&(0,e.createElement)("div",null,(0,t.__)("No audio files found","kotisivu-block-theme")),!f&&y.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u.default,{playerRef:i,trackRef:a}),(0,e.createElement)("ol",{ref:h,className:"audio-player__list","aria-label":(0,t.__)("Playlist","kotisivu-block-theme"),role:"list",onKeyDown:e=>g(e)},y.map(((s,l)=>{const u={id:l,title:s.title.rendered,album:s.media_details?.album,artist:s.media_details?.artist,format:s.media_details?.fileformat,sampleRate:s.media_details?.sample_rate,src:s.source_url,duration:s.media_details?.length,durationFormatted:s.media_details?.length_formatted,featuredImage:{src:s.metadata?.featured_image?.url,alt:s.metadata?.featured_image?.alt,height:s.metadata?.featured_image?.height,width:s.metadata?.featured_image?.width,title:s.metadata?.featured_image?.title}};return(0,e.createElement)("li",{key:u.id,className:"audio-player__list-item",role:"listItem",onClick:e=>async function(e,t,s){const l=i.current,u=a.current;if(a.current=s,r.current=t,await p(Date.now()),n&&a.current.id===u.id)return l.pause(),m(!1),void(0,d.pushMusicEventsToDatalayer)(a.current,l.currentTime,"pause");l.play(),m(!0),(0,d.pushMusicEventsToDatalayer)(a.current,l.currentTime,"play")}(0,l,u),"data-id":u.id,"data-src":u.src,"data-album":u.album,"data-artist":u.artist,"data-format":u.format,"data-samplerate":u.sampleRate,"aria-label":`${(0,t.__)("Play song","kotisivu-block-theme")} ${l+1} ${(0,t.__)("of","kotisivu-block-theme")} ${y.length} ${(0,t.__)("in playlist","kotisivu-block-theme")}`,"aria-current":r.current===l?"true":"false",tabIndex:"0"},(0,e.createElement)("span",{className:"audio-player__list-item-text"},(0,c.convertEntityToText)(u.title)),u.featuredImage.src?(0,e.createElement)("img",{className:"audio-player__list-item-image","aria-hidden":"true",src:u.featuredImage.src,alt:u.featuredImage.alt,height:u.featuredImage.height,width:u.featuredImage.width}):(0,e.createElement)(o.Placeholder,null))}))))))};n()((async function(){(0,e.createRoot)(document.getElementById("audio-player")).render((0,e.createElement)(m,null))}))}()}();
//# sourceMappingURL=audio-player-view-script.js.map