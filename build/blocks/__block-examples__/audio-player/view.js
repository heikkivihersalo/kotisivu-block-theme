(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,r=window.wp.i18n,i=window.wp.domReady;var n=e.n(i);const l=(0,a.createContext)(null),s=window.wp.apiFetch;var d=e.n(s);const u=e=>(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 1000 1000","aria-hidden":"true",...e},(0,t.createElement)("path",{d:"M500 0c275.958 0 500 224.042 500 500 0 275.958-224.042 500-500 500C224.042 1000 0 775.958 0 500 0 224.042 224.042 0 500 0Zm264 500L336 209.5v581L764 500Z",style:{fill:"var(--wp--preset--color--primary)"}})),m=e=>(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 1000 1000","aria-hidden":"true",...e},(0,t.createElement)("path",{d:"M500 0c275.958 0 500 224.042 500 500 0 275.958-224.042 500-500 500C224.042 1000 0 775.958 0 500 0 224.042 224.042 0 500 0Zm-49.799 236H305.522v528h144.679V236Zm244.277 0H549.799v528h144.679V236Z",style:{fill:"var(--wp--preset--color--primary)"}})),c=e=>(0,t.createElement)("svg",{className:"music-playlist__placeholder-image",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:400,height:400,style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 400 400",...e},(0,t.createElement)("path",{d:"M0 0h400v400H0z",style:{fill:"#ebebeb"}})),o=async e=>e.map(((e,t)=>({id:t,title:e?.title.rendered,artist:e?.media_details?.artist,album:e?.media_details?.album,meta:{sampleRate:e?.media_details?.sample_rate,format:e?.media_details?.fileformat},time:{duration:e?.media_details?.length,durationFormatted:e?.media_details?.length_formatted}})));async function _(e,t,a){const r=await(async e=>["play","pause","complete","seek","stream"].includes(e)?e:"undefined")(a),i=await((e,t)=>{const a=Math.round(e/t*100),r={0:15,15:25,25:50,50:75,75:100};for(let e in r)if(a<=r[e])return e})(t,e?.duration),n=await(async({id:e,title:t,artist:a,album:r,sampleRate:i,format:n})=>({id:e,title:t,artist:a,album:r,meta:{sampleRate:i,format:n}}))(e),l={current:Math.round(t),duration:e?.duration,percent:Math.round(t/e?.duration*100)};window.dataLayer=window.dataLayer||[],"seek"!==r&&"stream"!==r&&window.dataLayer.push({event:`music_${r}`,song:n,time:l}),window.dataLayer.push({event:`music_${a}_${i}`,song:n,time:l})}const p=({playerRef:e,trackRef:i})=>{const{isPlaying:n,setIsPlaying:s}=(0,a.useContext)(l),[d,o]=(0,a.useState)(0),[p,f]=(0,a.useState)(0),[h,g]=(0,a.useState)(0);function y(e){const t=Math.floor(e/60),a=e-60*t;return`${t}:${a<10?"0":""}${a}`}return(0,a.useEffect)((()=>{(async()=>{if(n)switch(p){case 16:case 26:case 51:case 76:await _(i.current,d,"stream")}})()}),[p]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"audio-player",tabIndex:"-1","aria-hidden":"true"},(0,t.createElement)("div",{className:"audio-player__info"},(0,t.createElement)("button",{className:"audio-player__btn audio-player__btn--play","data-state":n?"pause":"play",onClick:async function(t){await s(!n);const a=e.current;n?(a.pause(),_(i.current,a.currentTime,"pause")):(a.play(),_(i.current,a.currentTime,"play"))},tabIndex:-1,"aria-hidden":"true"},(0,t.createElement)("span",{className:"is-visually-hidden"},n?(0,r.__)("Pause","kotisivu-block-theme"):(0,r.__)("Play","kotisivu-block-theme")),n?(0,t.createElement)(m,null):(0,t.createElement)(u,null)),(0,t.createElement)("div",{className:"audio-player__track-details"},(0,t.createElement)("div",{className:"audio-player__now-playing"},(0,t.createElement)("h3",null,(0,r.__)("Now Playing","kotisivu-block-theme")),(0,t.createElement)("div",{className:"audio-player__quality"},(0,t.createElement)("span",{className:"audio-player__quality-item"},i.current?.format),(0,t.createElement)("span",{className:"audio-player__quality-item"},i.current?.sampleRate))),(0,t.createElement)("p",{className:"audio-player__track-name"},!i.current?.artist&&(0,r.__)("Loading...","kotisivu-block-theme"),i.current?.artist&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("span",{className:"audio-player__artist"},i.current?.artist),":"," ",(0,t.createElement)("span",{className:"audio-player__album"},i.current?.album)))),i.current?.featuredImage?(0,t.createElement)("img",{className:"audio-player__cover",src:i.current?.featuredImage.src,width:i.current?.featuredImage.width,height:i.current?.featuredImage.height,alt:i.current?.featuredImage.alt}):(0,t.createElement)(c,null)),(0,t.createElement)("div",{className:"audio-player__timeline"},(0,t.createElement)("div",{className:"audio-player__timeline-elapsed"},(0,t.createElement)("span",{className:"is-visually-hidden"},(0,r.__)("Elapsed Time","kotisivu-block-theme")),y(d)),(0,t.createElement)("label",{htmlFor:"audio-timeline",className:"is-visually-hidden"},(0,r.__)("Timeline","kotisivu-block-theme")),(0,t.createElement)("input",{type:"range",id:"audio-timeline",value:d,min:0,max:h,onChange:async function(t){const a=parseFloat(t.target.value);await o(a),e.current.currentTime=a,n&&_(i.current,a,"seek")},"aria-valuetext":`${d} seconds`,tabIndex:-1}),(0,t.createElement)("div",{className:"audio-player__timeline-duration"},(0,t.createElement)("span",{className:"is-visually-hidden"},(0,r.__)("Total Duration","kotisivu-block-theme")),y(h)))),(0,t.createElement)("audio",{className:"is-visually-hidden",controls:!0,ref:e,src:i.current?.src,onLoadedMetadata:async function(){await g(Math.round(e.current.duration))},onTimeUpdate:async function(){await o(Math.round(e.current.currentTime)),await f(Math.round(d/h*100))},onPlay:()=>s(!0),onPause:()=>s(!1)}),(0,t.createElement)("p",{className:"is-visually-hidden"},`${(0,r.__)("Now playing song","kotisivu-block-theme")} ${i.current?.album} ${(0,r.__)("from artist","kotisivu-block-theme")} ${i.current?.artist}`))},f=()=>{const e=(0,a.useRef)(null),i=(0,a.useRef)(0),n=(0,a.useRef)(null),[s,u]=(0,a.useState)(!1),[,m]=(0,a.useState)(Date.now()),[f,h]=function(e){const[t,r]=(0,a.useState)([]),[i,n]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(async()=>{let t=await async function(e=null){let t=new URL(window.location.origin+"/wp/v2/media");for(const[a,r]of Object.entries(e))t.searchParams.append(a,r);return await d()({path:t.pathname+t.search}).then((e=>e))}({per_page:25,media_type:"audio"});await r(t),e.current={id:0,title:t[0]?.title?.rendered,album:t[0]?.media_details?.album,artist:t[0]?.media_details?.artist,format:t[0]?.media_details?.fileformat,sampleRate:t[0]?.media_details?.sample_rate,src:t[0]?.source_url,duration:t[0]?.media_details?.length,durationFormatted:t[0]?.media_details?.length_formatted,featuredImage:{src:t[0]?.metadata?.featured_image?.url,alt:t[0]?.metadata?.featured_image?.alt,height:t[0]?.metadata?.featured_image?.height,width:t[0]?.metadata?.featured_image?.width,title:t[0]?.metadata?.featured_image?.title}},n(!1)})()}),[]),[t,i]}(e),[g,y]=function(e){const t=(0,a.useRef)(null),[r,i]=(0,a.useState)(!1),n=e=>{e.forEach((e=>{e.isIntersecting&&i(!0)}))};return(0,a.useEffect)((()=>{const a=new IntersectionObserver(n,e);return t.current&&a.observe(t.current),()=>{t.current&&a.unobserve(t.current)}}),[t.current,e]),[t,r]}({root:null,rootMargin:"0px",threshold:.5});async function w(){const t=n.current,a=await f.find(((e,t)=>{if(t===i.current)return e}));e.current={id:i.current,title:a.title.rendered,album:a.media_details?.album,artist:a.media_details?.artist,format:a.media_details?.fileformat,sampleRate:a.media_details?.sample_rate,src:a.source_url,duration:a.media_details?.length,durationFormatted:a.media_details?.length_formatted,featuredImage:{src:a.metadata?.featured_image?.url,alt:a.metadata?.featured_image?.alt,height:a.metadata?.featured_image?.height,width:a.metadata?.featured_image?.width,title:a.metadata?.featured_image?.title}},await m(Date.now()),document.querySelector('.audio-player__list-item[aria-current="true"]').focus(),s&&(t.play(),u(!0),_(e.current,t.currentTime,"play"))}return(0,a.useEffect)((()=>{y&&0!==f.length&&async function(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"music_view_tracks",songs:await o(e)})}(f)}),[y,f]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.Provider,{value:{isPlaying:s,setIsPlaying:u}},!f.length&&h&&(0,t.createElement)("div",null,(0,r.__)("Loading...","kotisivu-block-theme")),!f.length&&!h&&(0,t.createElement)("div",null,(0,r.__)("No audio files found","kotisivu-block-theme")),!h&&f.length>0&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)(p,{playerRef:n,trackRef:e}),(0,t.createElement)("ol",{ref:g,className:"audio-player__list","aria-label":(0,r.__)("Playlist","kotisivu-block-theme"),role:"list",onKeyDown:t=>async function(t){const a=n.current,r=parseInt(document.activeElement.dataset.id);switch(t.key){case" ":if(r===i.current)(async()=>{s?(a.pause(),u(!1),_(e.current,a.currentTime,"pause")):(a.play(),u(!0),_(e.current,a.currentTime,"play"))})();else{i.current=r;const t=await f.find(((e,t)=>{if(r===t)return e}));e.current={id:i.current,title:t.title.rendered,album:t.media_details?.album,artist:t.media_details?.artist,format:t.media_details?.fileformat,sampleRate:t.media_details?.sample_rate,src:t.source_url,duration:t.media_details?.length,durationFormatted:t.media_details?.length_formatted,featuredImage:{src:t.metadata?.featured_image?.url,alt:t.metadata?.featured_image?.alt,height:t.metadata?.featured_image?.height,width:t.metadata?.featured_image?.width,title:t.metadata?.featured_image?.title}},await m(Date.now()),n.current.play(),u(!0),_(e.current,a.currentTime,"play")}break;case"ArrowDown":"LI"===t.target.tagName&&t.preventDefault(),await(async()=>{i.current===f.length-1?i.current=0:i.current=i.current+1})(),w();break;case"ArrowUp":"LI"===t.target.tagName&&t.preventDefault(),await(async()=>{0===i.current?i.current=f.length-1:i.current=i.current-1})(),w()}await m(Date.now())}(t)},f.map(((a,l)=>{const d={id:l,title:a.title.rendered,album:a.media_details?.album,artist:a.media_details?.artist,format:a.media_details?.fileformat,sampleRate:a.media_details?.sample_rate,src:a.source_url,duration:a.media_details?.length,durationFormatted:a.media_details?.length_formatted,featuredImage:{src:a.metadata?.featured_image?.url,alt:a.metadata?.featured_image?.alt,height:a.metadata?.featured_image?.height,width:a.metadata?.featured_image?.width,title:a.metadata?.featured_image?.title}};return(0,t.createElement)("li",{key:d.id,className:"audio-player__list-item",role:"listItem",onClick:t=>async function(t,a,r){const l=n.current,d=e.current;if(e.current=r,i.current=a,await m(Date.now()),s&&e.current.id===d.id)return l.pause(),u(!1),void _(e.current,l.currentTime,"pause");l.play(),u(!0),_(e.current,l.currentTime,"play")}(0,l,d),"data-id":d.id,"data-src":d.src,"data-album":d.album,"data-artist":d.artist,"data-format":d.format,"data-samplerate":d.sampleRate,"aria-label":`${(0,r.__)("Play song","kotisivu-block-theme")} ${l+1} ${(0,r.__)("of","kotisivu-block-theme")} ${f.length} ${(0,r.__)("in playlist","kotisivu-block-theme")}`,"aria-current":i.current===l?"true":"false",tabIndex:"0"},(0,t.createElement)("span",{className:"audio-player__list-item-text"},function(e){const t={"&#8211;":"-"};for(const a in t)if(e.indexOf(a)>=0)return e.replaceAll(a,t[a]);return e}(d.title)),d.featuredImage.src?(0,t.createElement)("img",{className:"audio-player__list-item-image","aria-hidden":"true",src:d.featuredImage.src,alt:d.featuredImage.alt,height:d.featuredImage.height,width:d.featuredImage.width}):(0,t.createElement)(c,null))}))))))};n()((async function(){(0,a.createRoot)(document.getElementById("audio-player")).render((0,t.createElement)(f,null))}))})();